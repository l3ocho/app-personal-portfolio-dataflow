version: 2

models:
  - name: stg_cmhc__rentals
    description: "Staged CMHC rental market data from fact_rentals"
    columns:
      - name: rental_id
        description: "Unique identifier for rental record"
        data_tests:
          - unique
          - not_null
      - name: date_key
        description: "Date dimension key (YYYYMMDD)"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_dimensions__time')
              field: date_key
      - name: zone_key
        description: "CMHC zone dimension key"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_dimensions__cmhc_zones')
              field: zone_key

  - name: stg_dimensions__cmhc_zones
    description: "Staged CMHC zone dimension"
    columns:
      - name: zone_key
        description: "Zone dimension key"
        data_tests:
          - unique
          - not_null
      - name: zone_code
        description: "CMHC zone code"
        data_tests:
          - unique
          - not_null

  - name: stg_toronto__neighbourhoods
    description: "Staged Toronto neighbourhood dimension (158 official boundaries)"
    columns:
      - name: neighbourhood_id
        description: "Neighbourhood primary key"
        data_tests:
          - unique
          - not_null
      - name: neighbourhood_name
        description: "Official neighbourhood name"
        data_tests:
          - not_null
      - name: geometry
        description: "PostGIS geometry (POLYGON)"

  - name: stg_toronto__census
    description: "Staged census demographics by neighbourhood"
    columns:
      - name: census_id
        description: "Census record identifier"
        data_tests:
          - unique
          - not_null
      - name: neighbourhood_id
        description: "Neighbourhood foreign key"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: census_year
        description: "Census year (2016, 2021)"
        data_tests:
          - not_null

  - name: stg_toronto__crime
    description: "Staged crime statistics by neighbourhood"
    columns:
      - name: crime_id
        description: "Crime record identifier"
        data_tests:
          - unique
          - not_null
      - name: neighbourhood_id
        description: "Neighbourhood foreign key"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: crime_type
        description: "Type of crime"
        data_tests:
          - not_null

  - name: stg_toronto__amenities
    description: "Staged amenity counts by neighbourhood"
    columns:
      - name: amenity_id
        description: "Amenity record identifier"
        data_tests:
          - unique
          - not_null
      - name: neighbourhood_id
        description: "Neighbourhood foreign key"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: amenity_type
        description: "Type of amenity"
        data_tests:
          - not_null

  - name: stg_cmhc__zone_crosswalk
    description: "Staged CMHC zone to neighbourhood crosswalk with area weights"
    columns:
      - name: crosswalk_id
        description: "Crosswalk record identifier"
        data_tests:
          - unique
          - not_null
      - name: cmhc_zone_code
        description: "CMHC zone code"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_dimensions__cmhc_zones')
              field: zone_code
      - name: neighbourhood_id
        description: "Neighbourhood foreign key"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: area_weight
        description: "Proportional area weight (0-1)"
        data_tests:
          - not_null

  - name: stg_toronto__profiles
    description: "Staged neighbourhood community profile data"
    columns:
      - name: profile_id
        description: "Source record identifier"
        data_tests:
          - unique
          - not_null
      - name: neighbourhood_id
        description: "Neighbourhood foreign key"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: census_year
        description: "Census year"
        data_tests:
          - not_null
          - accepted_values:
              values: [2021]
      - name: category
        description: "Profile category"
        data_tests:
          - not_null
          - accepted_values:
              values:
                - immigration_status
                - place_of_birth
                - place_of_birth_recent
                - citizenship
                - generation_status
                - admission_category
                - visible_minority
                - ethnic_origin
                - mother_tongue
                - official_language
                - language_at_home
                - indigenous_identity
                - religion
                - education_level
                - field_of_study
                - commute_mode
                - commute_duration
                - commute_destination
                - housing_suitability
                - dwelling_type
                - bedrooms
                - construction_period
      - name: subcategory
        description: "Specific subcategory within category"
        data_tests:
          - not_null
      - name: level
        description: "Hierarchy level (continent/country) for place_of_birth; empty for others"
      - name: category_total
        description: "Section header total count (denominator for pct_of_neighbourhood); NULL on all non-header rows"
      - name: indent_level
        description: "XLSX hierarchy depth: 0=section header, 2=subtotal, 4=leaf detail row"
