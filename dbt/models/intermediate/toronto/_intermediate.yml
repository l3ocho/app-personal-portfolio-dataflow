version: 2

models:
  - name: int_rentals__annual
    description: "Rental data enriched with time and zone dimensions"
    columns:
      - name: rental_id
        data_tests:
          - unique
          - not_null
      - name: zone_code
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_dimensions__cmhc_zones')
              field: zone_code

  - name: int_neighbourhood__foundation
    description: "Neighbourhood foundation: census demographics (with CPI imputation) + ~55 extended scalar indicators from fact_census_extended. Supersedes int_neighbourhood__demographics."
    columns:
      - name: neighbourhood_id
        description: "Neighbourhood identifier"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: census_year
        description: "Census year"
        data_tests:
          - not_null
      - name: income_quintile
        description: "Income quintile (1-5, city-wide)"
      - name: is_imputed
        description: "True if income/education/dwelling values are CPI-adjusted estimates (2016-2020)"

  - name: int_neighbourhood__demographics
    description: "Combined census demographics with neighbourhood attributes"
    columns:
      - name: neighbourhood_id
        description: "Neighbourhood identifier"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: census_year
        description: "Census year"
        data_tests:
          - not_null
      - name: income_quintile
        description: "Income quintile (1-5, city-wide)"

  - name: int_neighbourhood__housing
    description: "Housing indicators combining census and rental data"
    columns:
      - name: neighbourhood_id
        description: "Neighbourhood identifier"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: year
        description: "Reference year"
      - name: rent_to_income_pct
        description: "Rent as percentage of median income"
      - name: is_affordable
        description: "Boolean: rent <= 30% of income"

  - name: int_neighbourhood__crime_summary
    description: "Aggregated crime with year-over-year trends"
    columns:
      - name: neighbourhood_id
        description: "Neighbourhood identifier"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: year
        description: "Statistics year"
        data_tests:
          - not_null
      - name: crime_rate_per_100k
        description: "Total crime rate per 100K population"
      - name: yoy_change_pct
        description: "Year-over-year change percentage"

  - name: int_neighbourhood__amenity_scores
    description: "Normalized amenities per capita and per area"
    columns:
      - name: neighbourhood_id
        description: "Neighbourhood identifier"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: year
        description: "Reference year"
      - name: total_amenities_per_1000
        description: "Total amenities per 1000 population"
      - name: amenities_per_sqkm
        description: "Total amenities per square km"

  - name: int_rentals__neighbourhood_allocated
    description: "CMHC rental data allocated to neighbourhoods via area weights"
    columns:
      - name: neighbourhood_id
        description: "Neighbourhood identifier"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: year
        description: "Survey year"
        data_tests:
          - not_null
      - name: avg_rent_2bed
        description: "Weighted average 2-bedroom rent"
      - name: vacancy_rate
        description: "Weighted average vacancy rate"

  - name: int_toronto__neighbourhood_profile
    description: "Neighbourhood community profile with computed percentages and diversity"
    columns:
      - name: neighbourhood_id
        description: "Neighbourhood identifier"
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_toronto__neighbourhoods')
              field: neighbourhood_id
      - name: census_year
        description: "Census year"
        data_tests:
          - not_null
      - name: category
        description: "Profile category"
        data_tests:
          - not_null
      - name: subcategory
        description: "Specific subcategory"
        data_tests:
          - not_null
      - name: pct_of_neighbourhood
        description: "Percentage of neighbourhood total within category"
      - name: pct_of_city
        description: "Percentage of city-wide total"
      - name: rank_in_neighbourhood
        description: "Rank within neighbourhood and category"
      - name: diversity_index
        description: "Shannon diversity index (visible_minority only)"
